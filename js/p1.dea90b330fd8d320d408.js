(()=>{"use strict";var e={776:function(e,n,t){var a=this&&this.__awaiter||function(e,n,t,a){return new(t||(t=Promise))((function(i,s){function o(e){try{d(a.next(e))}catch(e){s(e)}}function r(e){try{d(a.throw(e))}catch(e){s(e)}}function d(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,r)}d((a=a.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.getWinnerStatus=n.getWinner=n.saveWinner=n.updateWinner=n.createWinner=n.drive=n.stopEngine=n.startEngine=n.deleteWinner=n.deleteCar=n.createCar=n.getWinners=n.updateCar=n.getCar=n.getCars=void 0;const i=t(742);n.getCars=(e,n=i.constants.garagePagesLimit)=>a(void 0,void 0,void 0,(function*(){const t=yield fetch(`${i.path.garage}?_page=${e}&_limit=${n}`);return{items:yield t.json(),count:Number(t.headers.get("X-Total-Count"))}})),n.getCar=e=>a(void 0,void 0,void 0,(function*(){return(yield fetch(`${i.path.garage}/${e}`)).json()})),n.updateCar=(e,n)=>a(void 0,void 0,void 0,(function*(){return(yield fetch(`${i.path.garage}/${e}`,{method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})).json()})),n.getWinners=({page:e,limit:t=i.constants.defaultWinnersPage,sort:s,order:o})=>a(void 0,void 0,void 0,(function*(){const r=yield fetch(`${i.path.winners}?_page=${e}&_limit=${t}${((e,n)=>e&&n?`&_sort=${e}&_order=${n}`:"")(s,o)}`),d=yield r.json();return{items:yield Promise.all(d.map((e=>a(void 0,void 0,void 0,(function*(){return Object.assign(Object.assign({},e),{car:yield(0,n.getCar)(e.id)})}))))),count:Number(r.headers.get("X-Total-Count"))}})),n.createCar=e=>a(void 0,void 0,void 0,(function*(){return(yield fetch(i.path.garage,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json()})),n.deleteCar=e=>a(void 0,void 0,void 0,(function*(){return(yield fetch(`${i.path.garage}/${e}`,{method:"DELETE"})).json()})),n.deleteWinner=e=>a(void 0,void 0,void 0,(function*(){return(yield fetch(`${i.path.winners}/${e}`,{method:"DELETE"})).json()})),n.startEngine=e=>a(void 0,void 0,void 0,(function*(){return(yield fetch(`${i.path.engine}?id=${e}&status=started`,{method:"PATCH"})).json()})),n.stopEngine=e=>a(void 0,void 0,void 0,(function*(){return(yield fetch(`${i.path.engine}?id=${e}&status=stopped`,{method:"PATCH"})).json()})),n.drive=e=>a(void 0,void 0,void 0,(function*(){const n=yield fetch(`${i.path.engine}?id=${e}&status=drive`,{method:"PATCH"}).catch();return 200!==n.status?{success:!1}:Object.assign({},yield n.json())})),n.createWinner=e=>a(void 0,void 0,void 0,(function*(){return(yield fetch(i.path.winners,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json()})),n.updateWinner=(e,n)=>a(void 0,void 0,void 0,(function*(){return(yield fetch(`${i.path.winners}/${e}`,{method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})).json()})),n.saveWinner=({name:e,color:t,id:i,time:s})=>a(void 0,void 0,void 0,(function*(){if(404===(yield(0,n.getWinnerStatus)(i)))yield(0,n.createWinner)({id:i,wins:1,time:s});else{const e=yield(0,n.getWinner)(i);yield(0,n.updateWinner)(i,{id:i,wins:e.wins+1,time:s<e.time?s:e.time})}})),n.getWinner=e=>a(void 0,void 0,void 0,(function*(){return(yield fetch(`${i.path.winners}/${e}`)).json()})),n.getWinnerStatus=e=>a(void 0,void 0,void 0,(function*(){return(yield fetch(`${i.path.winners}/${e}`)).status}))},174:function(e,n,t){var a=this&&this.__awaiter||function(e,n,t,a){return new(t||(t=Promise))((function(i,s){function o(e){try{d(a.next(e))}catch(e){s(e)}}function r(e){try{d(a.throw(e))}catch(e){s(e)}}function d(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,r)}d((a=a.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0}),n.addListeners=n.render=n.PageButtonsUpdate=n.winnersUpdate=n.garageUpdate=void 0;const i=t(776),s=t(742),o=t(488),r=t(855);function d(){return a(this,void 0,void 0,(function*(){const e=yield(0,i.getCars)(o.storage.garagePage);o.storage.cars=e.items,o.storage.carsCount=e.count}))}function c(){return a(this,void 0,void 0,(function*(){const e=yield(0,i.getWinners)({page:o.storage.winnersPage,limit:s.constants.winnersPagesLimit,sort:o.storage.sort,order:o.storage.sortOrder});o.storage.winners=e.items,o.storage.winnersCount=e.count}))}function l(){const e=document.getElementById("prev"),n=document.getElementById("next"),t=document.querySelector(".garage-menu-btn"),a=document.querySelector(".winners-menu-btn");"garage"===o.storage.view?(t.disabled=!0,a.disabled=!1,o.storage.garagePage*s.constants.garagePagesLimit<o.storage.carsCount?n.disabled=!1:n.disabled=!0,o.storage.garagePage>1?e.disabled=!1:e.disabled=!0):"winners"===o.storage.view&&(t.disabled=!1,a.disabled=!0,o.storage.winnersPage*s.constants.winnersPagesLimit<o.storage.winnersCount?n.disabled=!1:n.disabled=!0,o.storage.winnersPage>1?e.disabled=!1:e.disabled=!0)}n.garageUpdate=d,n.winnersUpdate=c,n.PageButtonsUpdate=l,n.render=()=>a(void 0,void 0,void 0,(function*(){const e=`\n    <nav class="menu">\n      <button class="btn garage-menu-btn primary" id="garage-menu" disabled>To garage</button>\n      <button class="btn winners-menu-btn primary" id="winners-menu">To winners</button>\n    </nav>\n    <main id="garage-view">\n      <div class="winner-message" id="message">\n      </div>\n      <div>\n        <form class="form" id="create">\n          <input class="input" id="create-name" name="name" type="text">\n          <input class="color" id="create-color" name="color" type="color" value="#888888">\n          <button class="btn" type="submit">Create</button>\n        </form>\n        <form class="form" id="update">\n          <input class="input" id="update-name" name="name" type="text" disabled>\n          <input class="color" id="update-color" name="color" type="color" value="#888888" disabled>\n          <button class="btn" id="update-submit" type="submit" disabled>Update</button>\n        </form>\n      </div>\n      <div class="race-controls">\n        <button class="btn race-btn" id="race">Race</button>\n        <button class="btn reset-btn" id="reset">Reset</button>\n        <button class="btn generator-btn" id="generator">Generate cars</button>\n      </div>\n      <div id="garage-cars">\n        ${u()}\n      </div>\n    </main>\n    <main id="winners-view" style="display: none">\n      ${g()}\n    </main>\n    <nav class="pagination">\n      <button class="btn prev-btn primary" disabled id="prev">Previous page</button>\n      <button class="btn next-btn primary" disabled id="next">Next page</button>\n    </nav>\n  `,n=document.createElement("div");n.innerHTML=e,document.body.appendChild(n)}));const u=()=>`\n  <h1>Garage (total number of cars: ${o.storage.carsCount})</h1>\n  <h2>Page: ${o.storage.garagePage} / ${Math.ceil(o.storage.carsCount/s.constants.garagePagesLimit)}</h2>\n  <ul class="garage">\n  ${o.storage.cars.map((e=>`<li>${v(e)}</li>`)).join("")}\n  </ul>\n`,g=()=>`\n  <h1>Winners (total number of winners: ${o.storage.winnersCount})</h1>\n  <h2>Page: ${o.storage.winnersPage} / ${Math.ceil(o.storage.winnersCount/s.constants.winnersPagesLimit)}</h2>\n  <table class="table" cellspasing="0" border="0" cellpadding="0">\n    <thead>\n      <th>Number</th>\n      <th>Car</th>\n      <th>Name</th>\n      <th class="table-btn table-wins" id="sort-by-wins">Wins</th>\n      <th class="table-btn table-time" id="sort-by-time">Best time (seconds)</th>\n    </thead>\n    <tbody>\n      ${o.storage.winners.map(((e,n)=>`\n      <tr>\n        <td>${(o.storage.winnersPage-1)*s.constants.winnersPagesLimit+n+1}</td>\n        <td>${m(e.car.color)}</td>\n        <td>${e.car.name}</td>\n        <td>${e.wins}</td>\n        <td>${e.time}</td>\n      </tr>\n    `)).join("")}\n    </tbody>\n  </table>\n`,m=e=>`\n  <?xml version='1.0' encoding='iso-8859-1'?>\n  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 470 470" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 470 470">\n    <g fill='${e}'>\n      <path d="m126.184,358.951c19.299,0 35-15.701 35-35s-15.701-35-35-35-35,15.701-35,35 15.701,35 35,35zm0-55c11.028,0 20,8.972 20,20s-8.972,20-20,20-20-8.972-20-20 8.971-20 20-20z"/>\n      <path d="m343.816,288.951c-19.299,0-35,15.701-35,35s15.701,35 35,35 35-15.701 35-35-15.701-35-35-35zm0,55c-11.028,0-20-8.972-20-20s8.972-20 20-20 20,8.972 20,20-8.971,20-20,20z"/>\n      <path d="m137.5,116.049h23.779c4.143,0 7.5-3.358 7.5-7.5s-3.357-7.5-7.5-7.5h-23.779c-10.423,0-27.031,7.176-34.177,14.767l-60.088,63.845c-2.051,2.179-2.609,5.368-1.423,8.115 1.187,2.747 3.893,4.525 6.885,4.525h290.271c2.562,0 4.945-1.307 6.323-3.467 1.377-2.159 1.558-4.873 0.478-7.195l-30.854-66.365c-3.315-7.046-14.628-14.225-22.415-14.225h-101.221c-4.143,0-7.5,3.358-7.5,7.5l-.001,68.752h-117.722l48.19-51.204c4.243-4.508 17.066-10.048 23.254-10.048zm61.279,0h93.7c2.203,0.103 7.842,3.681 8.849,5.581l25.883,55.671h-128.433l.001-61.252z"/>\n      <path d="m470,257.692c0-26.631-20.555-55.149-45.819-63.57-0.017-0.006-35.078-11.693-35.078-11.693-5.854-1.951-13.576-8.812-16.203-14.394l-30.84-65.535c-8.299-17.636-30.068-31.451-49.56-31.451h-155c-18.639,0-43.247,10.632-56.022,24.206l-69.158,73.482c-6.909,7.34-12.32,20.984-12.32,31.064v94.15c0,20.678 16.822,37.5 37.5,37.5h14.06c3.775,37.846 35.8,67.5 74.624,67.5s70.849-29.654 74.624-67.5h45.509c4.143,0 7.5-3.358 7.5-7.5s-3.357-7.5-7.5-7.5h-45.509c-3.775-37.846-35.8-67.5-74.624-67.5s-70.849,29.654-74.624,67.5h-14.06c-12.406,0-22.5-10.093-22.5-22.5v-94.15c0-6.294 3.929-16.2 8.242-20.783l69.159-73.483c9.941-10.563 30.594-19.486 45.099-19.486h155c13.682,0 30.162,10.458 35.987,22.838l30.84,65.535c4.421,9.395 15.182,18.955 25.031,22.238l28.498,9.499c-0.492,2.841-0.748,5.729-0.748,8.642 0,25.238 18.65,46.198 42.892,49.831v29.32c0,12.407-8.357,22.5-18.631,22.5h-17.929c-3.775-37.846-35.8-67.5-74.624-67.5-41.355,0-75,33.645-75,75s33.645,75 75,75c38.824,0 70.849-29.654 74.624-67.5h17.929c18.544,0 33.631-16.822 33.631-37.5v-36.26zm-343.816,6.259c33.084,0 60,26.916 60,60s-26.916,60-60,60-60-26.916-60-60 26.916-60 60-60zm217.632,120c-33.084,0-60-26.916-60-60s26.916-60 60-60 60,26.916 60,60-26.916,60-60,60zm83.292-169.15c0-0.969 0.04-1.934 0.117-2.893 13.16,7.627 23.787,22.37 26.864,37.266-15.466-3.785-26.981-17.756-26.981-34.373z"/>\n    </g>\n  </svg>`,v=({id:e,name:n,color:t})=>`\n  <div class="car-header">\n    <div class="select-btns">\n      <button class="btn select-btn" id="select-car-${e}">Select</button>\n      <button class="btn remove-btn" id="remove-car-${e}">Remove</button>\n    </div>\n    <div class="car-name">${n}</div>\n  </div>\n  <div class = "car-row">\n    <div class="car-controls">\n    <button class="btn start-engine-btn" id="start-engine-car-${e}">Start</button>\n    <button class="btn stop-engine-btn" id="stop-engine-car-${e}" disabled>Stop</button>\n    </div>\n    <div class="road">\n        <div class="car" id="car-${e}">\n          ${m(t)}\n        </div>\n      <div class="flag"></div>\n    </div>\n  </div>\n`;function b(e){const n=document.querySelectorAll(".primary");e?n.forEach((e=>e.disabled=!0)):l()}function p(e){return a(this,void 0,void 0,(function*(){const n=document.getElementById(`start-engine-car-${e}`),t=document.getElementById(`stop-engine-car-${e}`);n.disabled=!0,n.classList.toggle("enabling",!0);const{velocity:a,distance:s}=yield(0,i.startEngine)(e),o=Math.round(s/a);n.classList.toggle("enabling",!1),t.disabled=!1;const r=document.getElementById(`car-${e}`);r.style.animationName="car-animation",r.style.animationDuration=`${o.toString()}ms`;const{success:d}=yield(0,i.drive)(e);return d||(r.style.animationPlayState="paused",r.classList.add("broken")),{success:d,id:e,time:o}}))}function y(e){return a(this,void 0,void 0,(function*(){const n=document.getElementById(`start-engine-car-${e}`),t=document.getElementById(`stop-engine-car-${e}`);t.disabled=!0,t.classList.toggle("enabling",!0),yield(0,i.stopEngine)(e),t.classList.toggle("enabling",!1),n.disabled=!1;const a=document.getElementById(`car-${e}`);a.style.animationName="none",a.style.animationPlayState="initial",a.classList.remove("broken")}))}function h(e,n){return a(this,void 0,void 0,(function*(){const{success:t,id:a,time:i}=yield Promise.race(e);if(!t){const t=n.findIndex((e=>e===a));return h([...e.slice(0,t),...e.slice(t+1,e.length)],[...n.slice(0,t),...n.slice(t+1,n.length)])}return Object.assign(Object.assign({},o.storage.cars.find((e=>e.id===a))),{time:+(i/1e3).toFixed(2)})}))}function f(e){return a(this,void 0,void 0,(function*(){"asc"===o.storage.sortOrder?o.storage.sortOrder="desc":o.storage.sortOrder="asc",o.storage.sort=e,yield c(),document.getElementById("winners-view").innerHTML=g()}))}n.addListeners=function(){const e=document.getElementById("garage-cars"),n=document.getElementById("create-name"),t=document.getElementById("create-color"),m=document.getElementById("create"),v=document.getElementById("update-name"),w=document.getElementById("update-color"),$=document.getElementById("update-submit"),P=document.getElementById("update");let L=null;document.body.addEventListener("click",(n=>a(this,void 0,void 0,(function*(){const t=n.target,m=document.getElementById("winners-view"),P=document.getElementById("garage-view"),C=document.getElementById("reset"),E=document.getElementById("race");if(t.classList.contains("prev-btn")&&("garage"===o.storage.view?(o.storage.garagePage-=1,yield d(),l(),e.innerHTML=u()):(o.storage.winnersPage-=1,yield c(),l(),m.innerHTML=g())),t.classList.contains("next-btn")&&("garage"===o.storage.view?(o.storage.garagePage+=1,yield d(),l(),e.innerHTML=u()):(o.storage.winnersPage+=1,yield c(),l(),m.innerHTML=g())),t.classList.contains("garage-menu-btn")&&(m.style.display="none",P.style.display="block",o.storage.view="garage",l()),t.classList.contains("winners-menu-btn")&&(m.style.display="block",P.style.display="none",yield c(),m.innerHTML=g(),o.storage.view="winners",l()),t.classList.contains("generator-btn")){t.disabled=!0;const n=(M=s.constants.generateCarsLimit,console.log("generate"),new Array(M).fill(0).map((e=>({name:`${r.carBrands[Math.floor(Math.random()*r.carBrands.length)]} ${r.carModels[Math.floor(Math.random()*r.carModels.length)]}`,color:"#"+("00000"+Math.floor(Math.random()*Math.pow(16,6)).toString(16)).slice(-6)}))));yield Promise.all(n.map((e=>a(this,void 0,void 0,(function*(){return(0,i.createCar)(e)}))))),yield d(),l(),e.innerHTML=u(),b(!1),t.disabled=!1}var M;if(t.classList.contains("remove-btn")){const n=+t.id.split("remove-car-")[1];yield(0,i.deleteCar)(n),yield(0,i.deleteWinner)(n),yield d(),e.innerHTML=u(),l()}if(t.classList.contains("select-btn")&&(L=yield(0,i.getCar)(+t.id.split("select-car-")[1]),v.value=L.name,w.value=L.color,v.disabled=!1,w.disabled=!1,$.disabled=!1),t.classList.contains("start-engine-btn")&&p(+t.id.split("start-engine-car-")[1]),t.classList.contains("stop-engine-btn")&&y(+t.id.split("stop-engine-car-")[1]),t.classList.contains("race-btn")){b(!0),t.disabled=!0;const e=yield function(e){return a(this,void 0,void 0,(function*(){const n=o.storage.cars.map((({id:n})=>e(n)));return yield h(n,o.storage.cars.map((e=>e.id)))}))}(p);yield(0,i.saveWinner)(e);const n=document.getElementById("message");n.innerHTML=`And the winner is ${e.name} with (${e.time}s)!`,n.classList.toggle("visible",!0),C.disabled=!1}if(t.classList.contains("reset-btn")){b(!1),t.disabled=!0,o.storage.cars.map((({id:e})=>y(e)));const e=document.getElementById("message");null==e||e.classList.toggle("visible",!1),E.disabled=!1}t.classList.contains("table-wins")&&f("wins"),t.classList.contains("table-time")&&f("time")})))),m.addEventListener("submit",(s=>a(this,void 0,void 0,(function*(){if(s.preventDefault(),n.value){const a={name:n.value,color:t.value};yield(0,i.createCar)(a),yield d(),e.innerHTML=u(),l(),n.value="",t.value="#888888"}else alert("Please enter the car name!")})))),P.addEventListener("submit",(n=>a(this,void 0,void 0,(function*(){n.preventDefault();const t={name:v.value,color:w.value};console.log("put"),console.log(null==L?void 0:L.id),L&&(yield(0,i.updateCar)(L.id,t)),yield d(),e.innerHTML=u(),v.value="",v.disabled=!0,w.disabled=!0,w.value="#888888",$.disabled=!0,L=null}))))}},855:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.carModels=n.carBrands=void 0,n.carBrands=["Audi","Alfa Romeo","Alpina","Aston Martin","Axon","Ford","Ferrari","Fiat","GAZ","GMC","Honda","Hummer","Hyundai","Infiniti","Isuzu","JAC","Jaguar","Jeep","Kamaz","Lada","Lexus","Lotus","MAN","Maybach","MAZ","Mazda","McLaren","Nissan","Opel","Paccar","Pagani","Pontiac","Porsche","Renault","Škoda","Smart","Subaru","Suzuki","Tesla","Toyota","UAZ","Volvo","ZAZ","XPeng","TVR","Saab","RAM","Chevrolet","Mazzanti","Daewoo","Zaporozhets"],n.carModels=["Gran Turismo","RS","Roadster","S","X","3","Y","Cybertruck","X5","X7","X3","X6","GT4","FXX","599 GTO","Enzo","458 Italia","250 GTO","Priora","4x4","Rio","Focus","Kalina","Vesta","Spark","Lacetti","Nexia","Matiz","Cobalt","Captiva","A7","A5","A3","A8","TT","Corolla","Camry","RAV4","Impreza","WRX","ES","LS","RX","GX","LX","GS","LC500","Gallardo","Aventador","911","Cayenne","FX37"]},742:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.path=n.constants=void 0,n.constants={defaultGaragePage:1,garagePagesLimit:7,defaultWinnersPage:1,winnersPagesLimit:10,generateCarsLimit:100};const t="http://127.0.0.1:3000";n.path={garage:`${t}/garage`,engine:`${t}/engine`,winners:`${t}/winners`}},303:function(e,n,t){var a=this&&this.__awaiter||function(e,n,t,a){return new(t||(t=Promise))((function(i,s){function o(e){try{d(a.next(e))}catch(e){s(e)}}function r(e){try{d(a.throw(e))}catch(e){s(e)}}function d(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,r)}d((a=a.apply(e,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});const i=t(174);!function(){a(this,void 0,void 0,(function*(){yield(0,i.garageUpdate)(),yield(0,i.render)(),(0,i.PageButtonsUpdate)(),(0,i.addListeners)(),console.log("Приветствую проверяющего!\nВсе обязательные функциональные требования вроде бы выполнил.\nВ случае каких-либо недоразумений, прошу со мной связаться.\nДискорд: @Vitaliy (bvfromru)#4741")}))}()},488:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.storage=void 0;const a=t(742);n.storage={garagePage:a.constants.defaultGaragePage,winnersPage:a.constants.defaultWinnersPage,cars:[],winners:[],carsCount:0,winnersCount:0,view:"garage",sort:"time",sortOrder:"asc"}}},n={};!function t(a){var i=n[a];if(void 0!==i)return i.exports;var s=n[a]={exports:{}};return e[a].call(s.exports,s,s.exports,t),s.exports}(303)})();